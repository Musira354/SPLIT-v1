{"ast":null,"code":"var data = [\"Give us feedback survey.walmart.com G\", \"Thank you! ID#:7SH6TOVM7GV 100\", \"SONY PSN 50 20.00 W\", \"Camera 20.00 W\", \"CARD# 6058120035996463439\", \"Walmart\", \"831-751-0231 Mgr:ERKAN M\", \"1800 N MAIN\", \"SALINAS CA 93906\", \"ST# 02458 OP# 000114 TE# 67 TR# 04762\", \"SONY PSN 10 079936608434 10.00 0\", \"SUBTOTAL 50.00\", \"TOTAL 50.00\", \"CASH TEND 50.00\", \"CHANGE DUE 0.00\", \"# ITEMS SOLD 1\", \"TC# 8928 8021 9403 6929 1894\", \"Walmart+ Become a member\", \"Scan for free 30-day trial pib\", \"Low Prices You Can Trust. Every Day.\", \"02/19/23 unspla\", \"ng along\"];\nvar data1 = [\"CASH RECEIPT\", \"Lorem ipsum dolor sit amet\", \"123-45-67\", \"Duis aute 5.45F\", \"Irure 2.55F\", \"Dolor 2.00\", \"TOTAL 10.00\", \"Tax 1.00\", \"THANK YOU\"];\nvar data2 = [\"TOGO\", \"Arigato Sushi\", \"1740 N Main ST.\", \"Salinas,CA 93906\", \"(831) 443-0100\", \"Walk-In-TOGO\", \"JOSEPH (831) 258-6603\", \"INV # 202302210111600 02/21/2021\", \"GUESTS:1 07:16PM\", \"Terminal:1 CLERK: VANESSA\", \"QT Description PRICE\", \"2 CALIFORNIA Roll 13.00\", \"SUBTOTAL 13.00\", \"Tax: 1.21\", \"TOTAL: 14.21\", \"CASH: 20.00\", \"CHANGE: -5.79\", \"Your ORDER #\", \"1116\"];\nvar data3 = [\"Burger KING #14730\", \"4859 Gerrardstown Rd.\", \"Inwood, WV 25423\", \"304-229-7992\", \"ORDER 69\", \"Drive THRU\", \"DBL WHOPPER CHS 5.99\", \"No picles\", \"Heavy mayo\", \"BISC EGG CHS 2.59\", \"LG COFFEE 1.79\", \"SUBTOTAL 10.37\", \"6.0% TAX\", \"0.62\", \"TOTAL 10.99\", \"CREDIT CARD 10.99\", \"CHANGE 0.00\", \"TOTAL CHARGE 10.99\", \"Visa\", \"AcctNum: XXXXXXXXXX9028\", \"Auth: 165997\", \"RefNum: 010269\", \"Merchant Id: 456163014990\"];\nvar taxMatchList = [\"tax\"];\nvar totalMatchList = [\"total\", \"balance\"];\nvar subtotalMatchList = [\"subtotal\"];\nexport function extractData(data) {\n  var receiptData = {};\n  var items = [];\n  var total;\n  receiptData.items = items;\n  var total = findValue(data, totalMatchList);\n  var tax = findValue(data, taxMatchList);\n  var subtotal = findValue(data, subtotalMatchList);\n  if (subtotal > 0) {\n    total = subtotal;\n  }\n  var itemTotalPrice = 0.0;\n  for (var x = 0; x < data.length; x++) {\n    var line = data[x];\n    if (hasNumber(line)) {\n      var itemName;\n      var price;\n      var words = data[x].split(\" \");\n      for (var i = 0; i < words.length; i++) {\n        var word = words[i];\n        if (!isFloat(word)) {\n          word.substring(1);\n          word = words[i].slice(0, -1);\n          word = word.replace(/[^0-9.]/g, '');\n        }\n        if (isFloat(word)) {\n          price = parseFloat(word);\n          if (price <= 0) {\n            continue;\n          }\n          itemName = line;\n          var length = line.length - words[i].length;\n          itemName = itemName.substring(itemName, length);\n          if (itemTotalPrice + price <= total + 0.3) {\n            price = parseFloat(price.toFixed(2));\n            itemTotalPrice += price;\n            var item = {\n              \"name\": itemName,\n              \"price\": price\n            };\n            receiptData.items.push(item);\n          } else {\n            break;\n          }\n        }\n      }\n    }\n  }\n  if (subtotal == -1) {\n    subtotal = itemTotalPrice;\n  }\n  if (difference(total, itemTotalPrice) < 0.1 && tax != -1) {\n    total = total + tax;\n  }\n  total = itemTotalPrice;\n  receiptData.subtotal = subtotal;\n  receiptData.total = total.toFixed(2);\n  receiptData.tax = tax.toFixed(2);\n  console.log(receiptData);\n  return receiptData;\n}\nfunction findValue(data, options) {\n  var value;\n  var foundValue = false;\n  for (var x = 0; x < data.length; x++) {\n    var line = data[x];\n    var words = line.split(\" \");\n    for (var z = 0; z < words.length; z++) {\n      var word = words[z];\n      if (foundValue) {\n        word = word.replace(/[^0-9.]/g, '');\n        if (isFloat(word)) {\n          value = parseFloat(word);\n          return value;\n        }\n      }\n      if (matchesOption(word, options)) {\n        foundValue = true;\n      }\n    }\n  }\n  return -1;\n}\nfunction difference(v1, v2) {\n  var v1 = Math.abs(v1);\n  var v2 = Math.abs(v2);\n  return Math.abs(v1 - v2);\n}\nfunction matchesOption(str, options) {\n  str = str.toLowerCase();\n  str = str.replace(\":\", \"\");\n  for (var x = 0; x < options.length; x++) {\n    if (str == options[x]) {\n      return true;\n    }\n  }\n  return false;\n}\nfunction isFloat(val) {\n  return !isNaN(val) && val.toString().indexOf('.') != -1;\n}\nfunction hasNumber(myString) {\n  return /\\d/.test(myString);\n}","map":{"version":3,"names":["data","data1","data2","data3","taxMatchList","totalMatchList","subtotalMatchList","extractData","receiptData","items","total","findValue","tax","subtotal","itemTotalPrice","x","length","line","hasNumber","itemName","price","words","split","i","word","isFloat","substring","slice","replace","parseFloat","toFixed","item","push","difference","console","log","options","value","foundValue","z","matchesOption","v1","v2","Math","abs","str","toLowerCase","val","isNaN","toString","indexOf","myString","test"],"sources":["D:/Work/Projects/Split/Split/backendFiles/TextParser.js"],"sourcesContent":["var data = [\"Give us feedback survey.walmart.com G\", \"Thank you! ID#:7SH6TOVM7GV 100\", \"SONY PSN 50 20.00 W\",  \"Camera 20.00 W\",\"CARD# 6058120035996463439\", \"Walmart\", \"831-751-0231 Mgr:ERKAN M\", \"1800 N MAIN\", \"SALINAS CA 93906\", \"ST# 02458 OP# 000114 TE# 67 TR# 04762\", \"SONY PSN 10 079936608434 10.00 0\", \"SUBTOTAL 50.00\", \"TOTAL 50.00\", \"CASH TEND 50.00\", \"CHANGE DUE 0.00\", \"# ITEMS SOLD 1\", \"TC# 8928 8021 9403 6929 1894\", \"Walmart+ Become a member\", \"Scan for free 30-day trial pib\", \"Low Prices You Can Trust. Every Day.\", \"02/19/23 unspla\", \"ng along\"]\r\nvar data1 = [\"CASH RECEIPT\",\"Lorem ipsum dolor sit amet\",\"123-45-67\",\"Duis aute 5.45F\",\"Irure 2.55F\",\"Dolor 2.00\", \"TOTAL 10.00\", \"Tax 1.00\",\"THANK YOU\"]\r\nvar data2 = [\"TOGO\", \"Arigato Sushi\", \"1740 N Main ST.\",  \"Salinas,CA 93906\",\"(831) 443-0100\", \"Walk-In-TOGO\", \"JOSEPH (831) 258-6603\", \"INV # 202302210111600 02/21/2021\",\"GUESTS:1 07:16PM\",\"Terminal:1 CLERK: VANESSA\",\"QT Description PRICE\", \"2 CALIFORNIA Roll 13.00\", \"SUBTOTAL 13.00\",\"Tax: 1.21\",\"TOTAL: 14.21\", \"CASH: 20.00\",\"CHANGE: -5.79\",\"Your ORDER #\",\"1116\"]\r\nvar data3 = [\"Burger KING #14730\", \"4859 Gerrardstown Rd.\", \"Inwood, WV 25423\",  \"304-229-7992\",\"ORDER 69\", \"Drive THRU\", \"DBL WHOPPER CHS 5.99\", \"No picles\",\"Heavy mayo\",\"BISC EGG CHS 2.59\",\"LG COFFEE 1.79\", \"SUBTOTAL 10.37\", \"6.0% TAX\",\"0.62\",\"TOTAL 10.99\", \"CREDIT CARD 10.99\",\"CHANGE 0.00\",\"TOTAL CHARGE 10.99\", \"Visa\",\"AcctNum: XXXXXXXXXX9028\",\"Auth: 165997\",\"RefNum: 010269\",\"Merchant Id: 456163014990\"]\r\nvar taxMatchList = [\"tax\"];\r\nvar totalMatchList = [\"total\",\"balance\",];\r\nvar subtotalMatchList = [\"subtotal\"];\r\n\r\n//make sure to export function\r\nexport function extractData(data){\r\n    var receiptData = {};\r\n    var items = [];\r\n    var total;\r\n    receiptData.items = items;\r\n    var total = findValue(data,totalMatchList);\r\n    var tax = findValue(data,taxMatchList);\r\n    var subtotal = findValue(data, subtotalMatchList);\r\n    if(subtotal > 0){\r\n        total = subtotal;\r\n    }\r\n    var itemTotalPrice = 0.0;\r\n    for (var x = 0; x < data.length; x++){\r\n        var line = data[x];\r\n        if(hasNumber(line)){\r\n                var itemName;\r\n                var price;\r\n                var words = data[x].split(\" \");\r\n                for (var i = 0; i < words.length; i++){\r\n                    let word = words[i];\r\n                    //some receipts add letters to end of price\r\n                    if(!isFloat(word)){\r\n                        word.substring(1);\r\n                        word = words[i].slice(0,-1);\r\n                        word = word.replace(/[^0-9.]/g, '');\r\n                    }\r\n                    if (isFloat(word)){\r\n                        //number is a float/price\r\n                        price = parseFloat(word);\r\n                        if(price <= 0){continue;}\r\n                        itemName = line;\r\n                        var length = line.length - words[i].length;\r\n                        itemName = itemName.substring(itemName, length);\r\n                        if(itemTotalPrice + price <= total + 0.3){\r\n                            price = parseFloat(price.toFixed(2));\r\n                            itemTotalPrice+=price;\r\n                            var item = {\r\n                                \"name\": itemName,\r\n                                \"price\": price\r\n                            }\r\n                            receiptData.items.push(item);\r\n                        }\r\n                        else{\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n        }\r\n    }\r\n    //if receipt does not have a subtotal just take the sum of all the items\r\n    if(subtotal==-1){\r\n        subtotal = itemTotalPrice;\r\n    }\r\n    //finding the real total\r\n    if(difference(total,itemTotalPrice)<0.1 && tax !=-1){\r\n        total = total + tax;\r\n    }\r\n\r\n    total = itemTotalPrice;\r\n    receiptData.subtotal = subtotal;\r\n    receiptData.total = total.toFixed(2);\r\n    receiptData.tax = tax.toFixed(2);\r\n    console.log(receiptData);\r\n    return receiptData;\r\n}\r\n//data is the receipt data, options is what you are looking for\r\n//example: tax, total/balance, subtotal\r\nfunction findValue(data,options){\r\n  var value;\r\n  var foundValue = false;\r\n  for (var x = 0; x < data.length; x++){\r\n      var line = data[x];\r\n      var words = line.split(\" \");\r\n      for(var z = 0;z < words.length;z++){\r\n          var word = words[z];\r\n          if(foundValue){\r\n            word = word.replace(/[^0-9.]/g, '');\r\n            if(isFloat(word)){\r\n              value = parseFloat(word);\r\n              return value;\r\n            }\r\n          }\r\n          if (matchesOption(word,options)){\r\n              foundValue= true;\r\n          }\r\n      }\r\n  }\r\n  return -1;\r\n}\r\nfunction difference(v1,v2){\r\n    var v1=Math.abs(v1);\r\n    var v2=Math.abs(v2);\r\n    return Math.abs(v1-v2);\r\n}\r\n//if equals one of the options return true, if none of the options match return false\r\nfunction matchesOption(str,options){\r\n    str = str.toLowerCase();\r\n    //some receipts add colon after so need to remove it\r\n    str = str.replace(\":\", \"\");\r\n    for (var x = 0;x<options.length;x++){\r\n        if(str == options[x]){\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction isFloat(val){\r\n    return (!isNaN(val) && val.toString().indexOf('.') != -1);\r\n}\r\nfunction hasNumber(myString) {\r\n  return /\\d/.test(myString);\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}